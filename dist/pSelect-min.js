function type(e){return Object.prototype.toString.call(e).replace(/\[object (.+)\]/i,"$1").toLowerCase()}!function(e){e.fn.pSelect=function(t){return console.time("lay"),this.each(function(){var a=e.extend(!0,{placeholder:e(this).attr("placeholder")},e.fn.pSelect.defaults,t),n=e(this);n.hide();var l=this,o=e("<div>",{class:"pSelect"});o.insertAfter(this),o.css({"font-size":a.baseSize,"text-align":a.align});var i=e("<div>",{class:"pSelect-box"}).text(a.placeholder);i.appendTo(o);var s,c,r,p,d,u=document.createElement("div");if(u.className="pSelect-wrapper",a.search.enable){var v=document.createElement("input");v.type="text",v.placeholder=a.search.placeholder;var f=document.createElement("div");f.classList.add("pSelect-preloader"),f.innerHTML=a.ajax.preloader;var h=document.createElement("div");h.classList.add("search-box"),h.appendChild(v),h.appendChild(f),u.appendChild(h)}function m(e){o.find("ul").remove(),s=document.createElement("ul"),n.find("option").each(function(t,n){var l=document.createElement("li");l.textContent=n.textContent,n.selected&&l.classList.add("pS-active"),n.disabled&&l.classList.add("pS-disabled"),e&&""!==a.ajax.url&&n.classList.add("pS-permanent");var o=document.createAttribute("data-value");o.value=n.value,l.setAttributeNode(o),s.appendChild(l)}),u.appendChild(s),o[0].appendChild(u),g(o.find(".pS-active"),{preventDefault:function(){}}),setTimeout(function(){v.focus()})}function S(t){void 0===t&&(t="");var a=e("body"),n=e(this).find(".pSelect-wrapper");if("close"===t||n.hasClass("open"))n.removeClass("open"),a.removeClass("pSelect-is-open");else if("open"===t||!n.hasClass("open")){a.hasClass("pSelect-is-open")?e(".pSelect-wrapper").removeClass("open"):a.addClass("pSelect-is-open"),n.addClass("open");try{setTimeout(function(){v.focus()},100)}catch(e){console.log(e)}}}function g(e,t,a){if(e.hasClass("pS-disabled"))return t.preventDefault(),t.stopPropagation(),!1;a&&n.val(e.attr("data-value")).trigger("change"),i.text(e.text())}m(!0),i.click((c=function(e){S.call(this.parentNode)},r=300,p=null,d=!1,function(){clearTimeout(p);var e=arguments;!d&&c.apply(this,e),d=!0,p=setTimeout(function(){d=!1},r)})),e(document).on("keydown",".pSelect-is-open",function(t){var a=s.clientHeight,n=a+25<s.scrollHeight;switch(t.key){case"ArrowDown":t.preventDefault(),(l=o.find(".open .pS-active").removeClass("pS-active")).length?((l=(l=l.next(":not(.hide)")).length?l:e(s.querySelector(":first-child"))).addClass("pS-active"),n&&!1+a+42<l[0].offsetTop?s.scrollTop+=42:n&&!1>l[0].offsetTop&&(s.scrollTop=0)):(o.find(".open li:eq(0):not(.hide)").addClass("pS-active"),n&&(s.scrollTop=0));break;case"ArrowUp":var l;t.preventDefault(),(l=o.find(".open li.pS-active")).length?(l.removeClass("pS-active"),l=l.prev(":not(.hide)"),window.tmp=l,window.wrapper=s,(l=l.length?l:e(s.querySelector(":last-child"))).addClass("pS-active"),n&&l[0].offsetTop-!1<100?s.scrollTop-=42:n&&l[0].offsetTop>a&&(s.scrollTop=s.scrollHeight)):o.find(".open li:last:not(.hide)").addClass("pS-active");break;case"Enter":t.preventDefault(),o.find(".open li.pS-active").click();break;case"Escape":t.preventDefault(),S.call(o,"close")}}),e(u).on("click","li",function(t){t.target!==h&&t.target!==v&&(g(e(this),t,!0),S.call(this.parentNode.parentNode.parentNode,"close"))}),n.on("change",function(){o.trigger("pSelect:update",!1)}),o.on("pSelect:update",function(e,t){g(o.find("li:eq("+n.get(0).selectedIndex+")"),e,t)}),a.search.enable&&!a.ajax.url&&v.addEventListener("input",function(){!function(e,t){for(var a=document.querySelectorAll(e),n=0;n<a.length;n++)~a[n].textContent.search(new RegExp((l=t,l.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&")),"gi"))?a[n].classList.remove("hide"):a[n].classList.add("hide");var l}(".pSelect-wrapper li",v.value)});var C,x,w,y=["ArrowUp","ArrowDown","Enter","Escape"];a.ajax.url&&e(v).keyup((C=function(t){~y.indexOf(t.key)||this.value.length>a.ajax.minChars&&(f.classList.add("loading"),e.get(a.ajax.url+v.value,function(e){for(var t in f.classList.remove("loading"),n.find("option:not(.pS-permanent)").remove(),e){var o=e[t];o="function"==typeof a.ajax.handleResults?a.ajax.handleResults(o):{value:o,title:o};var i=document.createElement("option");i.textContent=o.title,i.value=o.value,l.appendChild(i)}m(!1)}))},x=a.ajax.delay,function(){var e=this,t=arguments;clearTimeout(w),w=setTimeout(function(){w=null,C.apply(e,t)},x)}))})},e.fn.pSelect.defaults={baseSize:14,align:"center",search:{enable:!0,placeholder:"Enter 3 characters at least"},ajax:{url:!1,delay:500,minChars:3,preloader:'<div class="cssload-container">\t                        <div class="cssload-item cssload-moon"></div>                        </div>'}}}(jQuery);